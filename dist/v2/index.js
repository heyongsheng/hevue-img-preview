(function(u,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],g):(u=typeof globalThis<"u"?globalThis:u||self,g(u.hevueImgPreview={},u.Vue))})(this,function(u,g){"use strict";function x(e){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const t in e)if(t!=="default"){const s=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,s.get?s:{enumerable:!0,get:()=>e[t]})}}return i.default=e,Object.freeze(i)}const k=x(g);var _=function(){var e=this,i=e.$createElement,t=e._self._c||i;return e.visible?t("div",{ref:"heImg",staticClass:"hevue-imgpreview-wrap",attrs:{id:"hevue-imgpreview-wrap"},on:{mouseup:function(s){return e.removeMove("pc")},touchend:function(s){return e.removeMove("mobile")}}},[t("div",{staticClass:"hevue-img-mask",class:{heShow:e.showTranstion},on:{click:function(s){return s.stopPropagation(),e.clickMask.apply(null,arguments)}}}),t("div",{staticClass:"he-img-wrap",class:{heShow:e.showTranstion}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.imgState===1,expression:"imgState === 1"}],staticClass:"heimgfont hevue-img-status-icon rotate-animation"},[e._v("  ")]),e.vueVersion>2?t("transition-group",{attrs:{name:"fade"}},e._l(e.needLoadImg,function(s){return t("img",{directives:[{name:"show",rawName:"v-show",value:e.imgState===2&&e.imgIndex==s.index,expression:"imgState === 2 && imgIndex == item.index"}],key:s.index,ref:"heImg"+s.index,refInFor:!0,staticClass:"he-img-view",style:[e.imgIndex,e.fromIndex].includes(s.index)?e.getImgPostion:e.maxWH,attrs:{src:s.url},on:{click:function(n){n.stopPropagation()},contextmenu:e.imgContextMenu,mousedown:e.addMove,touchstart:e.addMoveMobile}})}),0):e._l(e.needLoadImg,function(s){return t("img",{directives:[{name:"show",rawName:"v-show",value:e.imgState===2&&e.imgIndex==s.index,expression:"imgState === 2 && imgIndex == item.index"}],key:s.index,ref:"heImg"+s.index,refInFor:!0,staticClass:"he-img-view",style:[e.imgIndex,e.fromIndex].includes(s.index)?e.getImgPostion:e.maxWH,attrs:{src:s.url},on:{click:function(n){n.stopPropagation()},contextmenu:e.imgContextMenu,mousedown:e.addMove,touchstart:e.addMoveMobile}})}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.imgState===3,expression:"imgState === 3"}],staticClass:"heimgfont hevue-img-status-icon"},[e._v("  ")]),e.closeBtn?t("div",{staticClass:"heimgfont he-close-icon",on:{click:function(s){return s.stopPropagation(),e.close({way:"closeBtn"})}}},[e._v("  ")]):e._e(),e.arrowBtn&&e.multiple?t("div",{staticClass:"arrow arrow-left heimgfont",on:{click:function(s){return s.stopPropagation(),e.prevNextHandle(!1,"arrow-btn")}}},[e._v("  ")]):e._e(),e.arrowBtn&&e.multiple?t("div",{staticClass:"arrow arrow-right heimgfont",on:{click:function(s){return s.stopPropagation(),e.prevNextHandle(!0,"arrow-btn")}}},[e._v("  ")]):e._e(),t("div",{staticClass:"he-bottom-wrap"},[t("transition",{attrs:{name:"fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showHevueImgRotate,expression:"showHevueImgRotate"}],staticClass:"hevue-custom-rotate-wrap"},[t("span",{staticClass:"hevue-custom-range-label"},[e._v(e._s(e.imgRotate)+"°")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.imgRotate,expression:"imgRotate",modifiers:{number:!0}}],staticClass:"hevue-custom-range",attrs:{type:"range",id:"vol",min:"0",max:"360",orient:"vertical"},domProps:{value:e.imgRotate},on:{__r:function(s){e.imgRotate=e._n(s.target.value)},blur:function(s){return e.$forceUpdate()}}})])]),e.controlBar.length?t("div",{staticClass:"he-control-bar",on:{click:function(s){s.stopPropagation()}}},e._l(e.controlbarShowItems,function(s,n){return t("div",{directives:[{name:"show",rawName:"v-show",value:s.show(),expression:"item.show()"}],key:n,staticClass:"he-control-btn heimgfont",attrs:{title:s.title},domProps:{innerHTML:e._s(s.icon)},on:{click:function(o){return o.stopPropagation(),s.handle()}}})}),0):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.thumbnail&&e.multiple,expression:"thumbnail && multiple"}],staticClass:"he-imglist-wrap"},[t("div",{staticClass:"he-imglist",style:{left:e.getThumbLeft()+"px"}},e._l(e.imgList,function(s,n){return t("div",{key:n,staticClass:"he-img-item",class:{active:n==e.imgIndex},on:{click:function(o){return e.toogleImg(n,"thumb")}}},[t("img",{staticClass:"he-img-item-img",attrs:{src:s},on:{contextmenu:e.imgContextMenu}})])}),0)]),e.controlBar&&e.multiple?t("div",{staticClass:"he-control-num"},[e._v(" "+e._s(e.imgIndex+1)+" / "+e._s(e.imgList.length)+" ")]):e._e()],1),t("transition",{attrs:{name:"fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showHevueImgHelp,expression:"showHevueImgHelp"}],staticClass:"hevue-img-help-wrap"},e._l(e.shortcutList,function(s){return t("div",{key:s.keyName,staticClass:"hevue-img-help-item"},[t("div",{staticClass:"hevue-img-help-item-label"},[e._v(e._s(s.keyName)+"：")]),t("div",{staticClass:"hevue-img-help-item-desc"},[e._v(e._s(s.desc))])])}),0)])],2)]):e._e()},b=[];const R="";function C(e,i,t,s,n,o,h,c){var a=typeof e=="function"?e.options:e;i&&(a.render=i,a.staticRenderFns=t,a._compiled=!0),s&&(a.functional=!0),o&&(a._scopeId="data-v-"+o);var r;if(h?(r=function(m){m=m||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!m&&typeof __VUE_SSR_CONTEXT__<"u"&&(m=__VUE_SSR_CONTEXT__),n&&n.call(this,m),m&&m._registeredComponents&&m._registeredComponents.add(h)},a._ssrRegister=r):n&&(r=c?function(){n.call(this,(a.functional?this.parent:this).$root.$options.shadowRoot)}:n),r)if(a.functional){a._injectStyles=r;var d=a.render;a.render=function(p,v){return r.call(v),d(p,v)}}else{var l=a.beforeCreate;a.beforeCreate=l?[].concat(l,r):[r]}return{exports:e,options:a}}const N={name:"hevue-img-preview",data(){return{vue:k,showHevueImgRotate:!1,visible:!1,imgScale:1,imgTop:0,imgLeft:0,imgRotate:0,isFull:!1,maxWH:{"max-width":"100%","max-height":"100%"},clientX:0,clientY:0,imgIndex:0,canRun:!0,imgurl:"",imgState:1,start:[{},{}],fromIndex:0,mobileScale:0,nowImgIndex:0,thumbnail:!0,controlBar:[],closeBtn:!0,arrowBtn:!0,keyboard:!0,clickMaskCLose:!0,closeFn:null,changeFn:null,customStyle:[],disabledImgRightClick:!1,showTranstion:!1,imgList:[],needLoadImg:[],showHevueImgHelp:!1,shortcutList:[{keyNum:27,keyName:"Esc",desc:"退出预览",handle:()=>{this.close({way:"esc"})}},{keyNum:65,keyName:"A",desc:"上一张",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-a")}},{keyNum:68,keyName:"D",desc:"下一张",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-d")}},{keyNum:87,keyName:"W",desc:"放大",handle:()=>{this.scaleFunc(.15)}},{keyNum:83,keyName:"S",desc:"缩小",handle:()=>{this.scaleFunc(-.15)}},{keyNum:37,keyName:"←",desc:"上一张",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-a")}},{keyNum:39,keyName:"→",desc:"下一张",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-d")}},{keyNum:38,keyName:"↑",desc:"放大",handle:()=>{this.scaleFunc(.15)}},{keyNum:40,keyName:"↓",desc:"缩小",handle:()=>{this.scaleFunc(-.15)}},{keyNum:81,keyName:"Q",desc:"逆时针旋转",handle:()=>{this.rotateFunc(-90)}},{keyNum:69,keyName:"E",desc:"顺时针旋转",handle:()=>{this.rotateFunc(90)}},{keyNum:82,keyName:"R",desc:"复位",handle:()=>{this.initImg()}}],controlbarAllItems:[{key:"zoomOut",icon:"&#xe65e;",title:"缩小",show:()=>!0,handle:()=>{this.scaleFunc(-.15)}},{key:"zoomIn",icon:"&#xe65d;",title:"放大",show:()=>!0,handle:()=>{this.scaleFunc(.15)}},{key:"rotateLeft",icon:"&#xe662;",title:"向左旋转",show:()=>!0,handle:()=>{this.rotateFunc(-90)}},{key:"customRotate",icon:"&#xe927;",title:"自定义旋转",show:()=>!0,handle:()=>{this.showHevueImgRotate=!this.showHevueImgRotate}},{key:"rotateRight",icon:"&#xe663;",title:"向右旋转",show:()=>!0,handle:()=>{this.rotateFunc(90)}},{key:"reset",icon:"&#xe86b;",title:"复位",show:()=>!0,handle:()=>{this.initImg()}},{key:"prev",icon:"&#xe62f;",title:"上一个",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!1,"control-bar")}},{key:"next",icon:"&#xe62e;",title:"下一个",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!0,"control-bar")}},{key:"download",icon:"&#xe694;",title:"下载",show:()=>!0,handle:()=>{this.downloadIamge()}},{key:"help",icon:"&#xe626;",title:"帮助",show:()=>this.keyboard,handle:()=>{this.showHevueImgHelp=!this.showHevueImgHelp}}]}},created(){console.log(666)},mounted(){console.log(),this.initImg()},computed:{vueVersion(){return parseInt(this.vue.version)},controlbarShowItems(){return this.controlBar.map(e=>this.controlbarAllItems.find(t=>t.key===e))},multiple(){return Array.isArray(this.imgList)&&this.imgList.length>1},getImgPostion(){return{...this.maxWH,transform:`scale(${this.imgScale}) rotate(${this.imgRotate}deg)`,marginTop:this.imgTop+"px",marginLeft:this.imgLeft+"px"}}},watch:{customStyle:{handler(e){let i=Object.entries(e);this.$nextTick(()=>{i.length>0&&i.forEach(t=>{let s=t[0],n=t[1],o=document.querySelector(".hevue-imgpreview-wrap");o&&o.style.setProperty(s,n)})})},immediate:!0,deep:!0},url(){this.initImg()},visible:{handler(e){e&&(console.log(777),this.$nextTick(()=>{let i=document.getElementById("hevue-imgpreview-wrap");i.onmousewheel=this.scrollFunc,document.body.addEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=function(){return!1},Array.isArray(this.controlBar)?this.controlBar.length===0&&(this.controlBar=this.controlbarAllItems.map(t=>t.key)):this.controlBar=[],this.url&&(!this.imgList||this.imgList.length===0)&&(this.imgList=[this.url]),this.imgIndex=Number(this.nowImgIndex)||0,this.changeUrl(this.imgList[this.imgIndex],this.imgIndex),this.keyboard&&document.addEventListener("keydown",this.keyHandleDebounce)}))},immediate:!0}},methods:{show(){this.visible=!0,setTimeout(()=>{this.showTranstion=!0},20)},close(e){this.showTranstion=!1,setTimeout(()=>{this.initImg(),document.body.removeEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=null,this.keyboard&&document.removeEventListener("keydown",this.keyHandleDebounce),this.visible=!1,this.closeFn&&this.closeFn(e),this.showHevueImgHelp=!1,this.imgList=[]},500)},initImg(){this.mobileScale=1,this.imgScale=1,this.imgRotate=0,this.imgTop=0,this.imgLeft=0},imgContextMenu(e){e=e||window.event,this.disabledImgRightClick&&e.preventDefault()},prevNextHandle(e,i){let t=0;e?(t=this.imgIndex+1,t>this.imgList.length-1&&(t=0)):(t=this.imgIndex-1,t<0&&(t=this.imgList.length-1)),this.toogleImg(t,i,e)},toogleImg(e,i,t){if(this.imgIndex===e)return;this.fromIndex=this.imgIndex;let s=this.imgIndex;this.imgIndex=e;let n=i=="thumb"?"thumb":t?"next":"prev";this.changeFn&&this.changeFn({type:n,fromImgIndex:s,fromImgUrl:this.imgList[s],toImgIndex:this.imgIndex,toImgUrl:this.imgList[this.imgIndex],way:i}),this.changeUrl(this.imgList[this.imgIndex],this.imgIndex)},changeUrl(e,i){this.needLoadImg.find(s=>s.index==i)?this.imgState=2:(this.imgState=1,this.needLoadImg.push({url:e,index:i}),this.$nextTick(()=>{let s=this.$refs["heImg"+i][0];s.onload=()=>{i!=null&&i==this.imgIndex?this.imgState=2:i==null&&(this.imgState=2)},s.onerror=()=>{i!=null&&i==this.imgIndex?this.imgState=3:i==null&&(this.imgState=3)}}))},getThumbLeft(){return-(this.imgIndex*100+50)},rotateFunc(e){let i=+this.imgRotate+e;i>360?i=i-360:i<0&&(i=360+i),this.imgRotate=i},scaleFunc(e,i){this.imgScale<=.2&&e<0||(i?this.imgScale=e:this.imgScale+=e)},imgToggle(){this.initImg(),this.isFull?this.maxWH={"max-width":"100%","max-height":"100%"}:this.maxWH="",this.isFull=!this.isFull},scrollFunc(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&this.scaleFunc(.05),e.delta<0&&this.scaleFunc(-.05)},addMove(e){console.log(e),e=e||window.event,this.clientX=e.clientX,this.clientY=e.clientY,this.$refs.heImg.onmousemove=this.moveFunc},addMoveMobile(e){e.preventDefault(),e=e||window.event,e.touches.length>1?this.start=e.touches:(this.clientX=e.touches[0].pageX,this.clientY=e.touches[0].pageY),this.$refs.heImg.ontouchmove=this.moveFuncMobile},moveFunc(e){e=e||window.event,e.preventDefault();let i=e.clientX-this.clientX,t=e.clientY-this.clientY;this.imgLeft+=i*2,this.imgTop+=t*2,this.clientX=e.clientX,this.clientY=e.clientY},moveFuncMobile(e){if(e=e||window.event,e.touches.length>1){var i=e.touches,t=this.getDistance(i[0],i[1])/this.getDistance(this.start[0],this.start[1]);this.mobileScale?t>1?this.scaleFunc(t+this.mobileScale-1,!0):this.scaleFunc(t*this.mobileScale,!0):this.scaleFunc(t,!0)}else{let s=e.touches[0];e.preventDefault();let n=s.pageX-this.clientX,o=s.pageY-this.clientY;this.imgLeft+=n*2,this.imgTop+=o*2,this.clientX=s.pageX,this.clientY=s.pageY}},removeMove(e){e==="pc"?this.$refs.heImg.onmousemove=null:(this.mobileScale=this.imgScale,this.$refs.heImg.ontouchmove=null)},keyHandleDebounce(e){this.canRun&&(this.keyHandle(e),this.canRun=!1,setTimeout(()=>{this.canRun=!0},100))},keyHandle(e){e=window.event||e;var i=e.keyCode||e.which||e.charCode;let t=this.shortcutList.find(s=>s.keyNum===i);t&&t.handle()},clickMask(){this.clickMaskCLose&&this.close({way:"mask"})},getDistance(e,i){var t=i.pageX-e.pageX,s=i.pageY-e.pageY;return Math.sqrt(t*t+s*s)},downloadIamge(){let e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){let i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0,e.width,e.height);let s=i.toDataURL("image/png"),n=document.createElement("a"),o=new MouseEvent("click");n.download="photo"+ +new Date,n.href=s,n.dispatchEvent(o)},e.onerror=function(i){console.log("图片信息不正确或图片服务器禁止访问"),console.log(i)},e.src=this.imgList[this.imgIndex]},isValidColor(e,i,t,s){if(s<128)return!1;const n=(e+i+t)/3;return!(n>240||n<15)},getDominantColorWithFilter(e){const i=document.createElement("canvas"),t=i.getContext("2d"),s=100,n=Math.min(s/e.naturalWidth,s/e.naturalHeight,1);i.width=e.width*n,i.height=e.height*n,t.drawImage(e,0,0);const h=t.getImageData(0,0,i.width,i.height).data,c={};let a=0,r="";for(let l=0;l<h.length;l+=4){const m=h[l],p=h[l+1],v=h[l+2],M=h[l+3];if(!this.isValidColor(m,p,v,M))continue;const f=`${m},${p},${v}`;c[f]=(c[f]||0)+1,c[f]>a&&(a=c[f],r=f)}console.log(r),console.log(r);const d=document.querySelector(".hevue-imgpreview-wrap.glass");return d.style.setProperty("--hevueimg-main-text-color",`rgb(${r}, .7)`),d.style.setProperty("--hevueimg-main-text-color",`rgb(${r}, .5)`),r},rgbToHsl(e,i,t){e/=255,i/=255,t/=255;const s=Math.max(e,i,t),n=Math.min(e,i,t);let o,h,c=(s+n)/2;if(s===n)o=h=0;else{const a=s-n;switch(h=c>.5?a/(2-s-n):a/(s+n),s){case e:o=(i-t)/a+(i<t?6:0);break;case i:o=(t-e)/a+2;break;case t:o=(e-i)/a+4;break}o/=6}return[o*360,h,c]},hslToRgb(e,i,t){e/=360;let s,n,o;if(i===0)s=n=o=t;else{const h=(r,d,l)=>(l<0&&(l+=1),l>1&&(l-=1),l<.16666666666666666?r+(d-r)*6*l:l<.5?d:l<.6666666666666666?r+(d-r)*(.6666666666666666-l)*6:r),c=t<.5?t*(1+i):t+i-t*i,a=2*t-c;s=h(a,c,e+1/3),n=h(a,c,e),o=h(a,c,e-1/3)}return[Math.round(s*255),Math.round(n*255),Math.round(o*255)]},adjustColor(e,i=.5){const[t,s]=this.rgbToHsl(...e);return this.hslToRgb(t,s,i)}}},y={};var S=C(N,_,b,!1,L,"580dcf84",null,null);function L(e){for(let i in y)this[i]=y[i]}const H=function(){return S.exports}();let w={};function I(e){typeof e=="string"?e={imgList:[e]}:Array.isArray(e)&&(e={imgList:e}),Object.keys(w).forEach(o=>{e[o]===void 0&&(e[o]=w[o])});const i=document.getElementById("hevue-img-preview-container");i&&i.remove();const t=g.extend(H),s=new t({data:e});s.$mount();let n=s.$el;return document.body.appendChild(n),s.show(),s}const F={install(e,i={}){w=i,e.prototype.$hevueImgPreview=I}};u.default=F,u.previewImages=I,Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
