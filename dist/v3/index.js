(function(d,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(d=typeof globalThis<"u"?globalThis:d||self,i(d.hevueImgPreview={},d.Vue))})(this,function(d,i){"use strict";function x(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const l=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const I=x(i),v=(e,t)=>{const n=e.__vccOpts||e;for(const[l,s]of t)n[l]=s;return n},b={name:"hevue-img-preview",data(){return{vue:I,showHevueImgRotate:!1,visible:!1,imgScale:1,imgTop:0,imgLeft:0,imgRotate:0,isFull:!1,maxWH:{"max-width":"100%","max-height":"100%"},clientX:0,clientY:0,imgIndex:0,canRun:!0,imgurl:"",imgState:1,start:[{},{}],fromIndex:0,mobileScale:0,nowImgIndex:0,thumbnail:!0,controlBar:[],closeBtn:!0,arrowBtn:!0,keyboard:!0,clickMaskCLose:!0,closeFn:null,changeFn:null,customStyle:[],disabledImgRightClick:!1,showTranstion:!1,imgList:[],needLoadImg:[],showHevueImgHelp:!1,shortcutList:[{keyNum:27,keyName:"Esc",desc:"退出预览",handle:()=>{this.close({way:"esc"})}},{keyNum:65,keyName:"A",desc:"上一张",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-a")}},{keyNum:68,keyName:"D",desc:"下一张",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-d")}},{keyNum:87,keyName:"W",desc:"放大",handle:()=>{this.scaleFunc(.15)}},{keyNum:83,keyName:"S",desc:"缩小",handle:()=>{this.scaleFunc(-.15)}},{keyNum:37,keyName:"←",desc:"上一张",handle:()=>{this.multiple&&this.prevNextHandle(!1,"key-a")}},{keyNum:39,keyName:"→",desc:"下一张",handle:()=>{this.multiple&&this.prevNextHandle(!0,"key-d")}},{keyNum:38,keyName:"↑",desc:"放大",handle:()=>{this.scaleFunc(.15)}},{keyNum:40,keyName:"↓",desc:"缩小",handle:()=>{this.scaleFunc(-.15)}},{keyNum:81,keyName:"Q",desc:"逆时针旋转",handle:()=>{this.rotateFunc(-90)}},{keyNum:69,keyName:"E",desc:"顺时针旋转",handle:()=>{this.rotateFunc(90)}},{keyNum:82,keyName:"R",desc:"复位",handle:()=>{this.initImg()}}],controlbarAllItems:[{key:"zoomOut",icon:"&#xe65e;",title:"缩小",show:()=>!0,handle:()=>{this.scaleFunc(-.15)}},{key:"zoomIn",icon:"&#xe65d;",title:"放大",show:()=>!0,handle:()=>{this.scaleFunc(.15)}},{key:"rotateLeft",icon:"&#xe662;",title:"向左旋转",show:()=>!0,handle:()=>{this.rotateFunc(-90)}},{key:"customRotate",icon:"&#xe927;",title:"自定义旋转",show:()=>!0,handle:()=>{this.showHevueImgRotate=!this.showHevueImgRotate}},{key:"rotateRight",icon:"&#xe663;",title:"向右旋转",show:()=>!0,handle:()=>{this.rotateFunc(90)}},{key:"reset",icon:"&#xe86b;",title:"复位",show:()=>!0,handle:()=>{this.initImg()}},{key:"prev",icon:"&#xe62f;",title:"上一个",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!1,"control-bar")}},{key:"next",icon:"&#xe62e;",title:"下一个",show:()=>()=>this.multiple,handle:()=>{this.prevNextHandle(!0,"control-bar")}},{key:"download",icon:"&#xe694;",title:"下载",show:()=>!0,handle:()=>{this.downloadIamge()}},{key:"help",icon:"&#xe626;",title:"帮助",show:()=>this.keyboard,handle:()=>{this.showHevueImgHelp=!this.showHevueImgHelp}}]}},created(){console.log(666)},mounted(){console.log(),this.initImg()},computed:{vueVersion(){return parseInt(this.vue.version)},controlbarShowItems(){return this.controlBar.map(e=>this.controlbarAllItems.find(n=>n.key===e))},multiple(){return Array.isArray(this.imgList)&&this.imgList.length>1},getImgPostion(){return{...this.maxWH,transform:`scale(${this.imgScale}) rotate(${this.imgRotate}deg)`,marginTop:this.imgTop+"px",marginLeft:this.imgLeft+"px"}}},watch:{customStyle:{handler(e){let t=Object.entries(e);this.$nextTick(()=>{t.length>0&&t.forEach(n=>{let l=n[0],s=n[1],o=document.querySelector(".hevue-imgpreview-wrap");o&&o.style.setProperty(l,s)})})},immediate:!0,deep:!0},url(){this.initImg()},visible:{handler(e){e&&(console.log(777),this.$nextTick(()=>{let t=document.getElementById("hevue-imgpreview-wrap");t.onmousewheel=this.scrollFunc,document.body.addEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=function(){return!1},Array.isArray(this.controlBar)?this.controlBar.length===0&&(this.controlBar=this.controlbarAllItems.map(n=>n.key)):this.controlBar=[],this.url&&(!this.imgList||this.imgList.length===0)&&(this.imgList=[this.url]),this.imgIndex=Number(this.nowImgIndex)||0,this.changeUrl(this.imgList[this.imgIndex],this.imgIndex),this.keyboard&&document.addEventListener("keydown",this.keyHandleDebounce)}))},immediate:!0}},methods:{show(){this.visible=!0,setTimeout(()=>{this.showTranstion=!0},20)},close(e){this.showTranstion=!1,setTimeout(()=>{this.initImg(),document.body.removeEventListener("DOMMouseScroll",this.scrollFunc),document.ondragstart=null,this.keyboard&&document.removeEventListener("keydown",this.keyHandleDebounce),this.visible=!1,this.closeFn&&this.closeFn(e),this.showHevueImgHelp=!1,this.imgList=[]},500)},initImg(){this.mobileScale=1,this.imgScale=1,this.imgRotate=0,this.imgTop=0,this.imgLeft=0},imgContextMenu(e){e=e||window.event,this.disabledImgRightClick&&e.preventDefault()},prevNextHandle(e,t){let n=0;e?(n=this.imgIndex+1,n>this.imgList.length-1&&(n=0)):(n=this.imgIndex-1,n<0&&(n=this.imgList.length-1)),this.toogleImg(n,t,e)},toogleImg(e,t,n){if(this.imgIndex===e)return;this.fromIndex=this.imgIndex;let l=this.imgIndex;this.imgIndex=e;let s=t=="thumb"?"thumb":n?"next":"prev";this.changeFn&&this.changeFn({type:s,fromImgIndex:l,fromImgUrl:this.imgList[l],toImgIndex:this.imgIndex,toImgUrl:this.imgList[this.imgIndex],way:t}),this.changeUrl(this.imgList[this.imgIndex],this.imgIndex)},changeUrl(e,t){this.needLoadImg.find(l=>l.index==t)?this.imgState=2:(this.imgState=1,this.needLoadImg.push({url:e,index:t}),this.$nextTick(()=>{let l=this.$refs["heImg"+t][0];l.onload=()=>{t!=null&&t==this.imgIndex?this.imgState=2:t==null&&(this.imgState=2)},l.onerror=()=>{t!=null&&t==this.imgIndex?this.imgState=3:t==null&&(this.imgState=3)}}))},getThumbLeft(){return-(this.imgIndex*100+50)},rotateFunc(e){let t=+this.imgRotate+e;t>360?t=t-360:t<0&&(t=360+t),this.imgRotate=t},scaleFunc(e,t){this.imgScale<=.2&&e<0||(t?this.imgScale=e:this.imgScale+=e)},imgToggle(){this.initImg(),this.isFull?this.maxWH={"max-width":"100%","max-height":"100%"}:this.maxWH="",this.isFull=!this.isFull},scrollFunc(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&this.scaleFunc(.05),e.delta<0&&this.scaleFunc(-.05)},addMove(e){console.log(e),e=e||window.event,this.clientX=e.clientX,this.clientY=e.clientY,this.$refs.heImg.onmousemove=this.moveFunc},addMoveMobile(e){e.preventDefault(),e=e||window.event,e.touches.length>1?this.start=e.touches:(this.clientX=e.touches[0].pageX,this.clientY=e.touches[0].pageY),this.$refs.heImg.ontouchmove=this.moveFuncMobile},moveFunc(e){e=e||window.event,e.preventDefault();let t=e.clientX-this.clientX,n=e.clientY-this.clientY;this.imgLeft+=t*2,this.imgTop+=n*2,this.clientX=e.clientX,this.clientY=e.clientY},moveFuncMobile(e){if(e=e||window.event,e.touches.length>1){var t=e.touches,n=this.getDistance(t[0],t[1])/this.getDistance(this.start[0],this.start[1]);this.mobileScale?n>1?this.scaleFunc(n+this.mobileScale-1,!0):this.scaleFunc(n*this.mobileScale,!0):this.scaleFunc(n,!0)}else{let l=e.touches[0];e.preventDefault();let s=l.pageX-this.clientX,o=l.pageY-this.clientY;this.imgLeft+=s*2,this.imgTop+=o*2,this.clientX=l.pageX,this.clientY=l.pageY}},removeMove(e){e==="pc"?this.$refs.heImg.onmousemove=null:(this.mobileScale=this.imgScale,this.$refs.heImg.ontouchmove=null)},keyHandleDebounce(e){this.canRun&&(this.keyHandle(e),this.canRun=!1,setTimeout(()=>{this.canRun=!0},100))},keyHandle(e){e=window.event||e;var t=e.keyCode||e.which||e.charCode;let n=this.shortcutList.find(l=>l.keyNum===t);n&&n.handle()},clickMask(){this.clickMaskCLose&&this.close({way:"mask"})},getDistance(e,t){var n=t.pageX-e.pageX,l=t.pageY-e.pageY;return Math.sqrt(n*n+l*l)},downloadIamge(){let e=new Image;e.setAttribute("crossOrigin","anonymous"),e.onload=function(){let t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height);let l=t.toDataURL("image/png"),s=document.createElement("a"),o=new MouseEvent("click");s.download="photo"+ +new Date,s.href=l,s.dispatchEvent(o)},e.onerror=function(t){console.log("图片信息不正确或图片服务器禁止访问"),console.log(t)},e.src=this.imgList[this.imgIndex]},isValidColor(e,t,n,l){if(l<128)return!1;const s=(e+t+n)/3;return!(s>240||s<15)},getDominantColorWithFilter(e){const t=document.createElement("canvas"),n=t.getContext("2d"),l=100,s=Math.min(l/e.naturalWidth,l/e.naturalHeight,1);t.width=e.width*s,t.height=e.height*s,n.drawImage(e,0,0);const r=n.getImageData(0,0,t.width,t.height).data,a={};let m=0,c="";for(let h=0;h<r.length;h+=4){const w=r[h],y=r[h+1],p=r[h+2],A=r[h+3];if(!this.isValidColor(w,y,p,A))continue;const u=`${w},${y},${p}`;a[u]=(a[u]||0)+1,a[u]>m&&(m=a[u],c=u)}console.log(c),console.log(c);const g=document.querySelector(".hevue-imgpreview-wrap.glass");return g.style.setProperty("--hevueimg-main-text-color",`rgb(${c}, .7)`),g.style.setProperty("--hevueimg-main-text-color",`rgb(${c}, .5)`),c},rgbToHsl(e,t,n){e/=255,t/=255,n/=255;const l=Math.max(e,t,n),s=Math.min(e,t,n);let o,r,a=(l+s)/2;if(l===s)o=r=0;else{const m=l-s;switch(r=a>.5?m/(2-l-s):m/(l+s),l){case e:o=(t-n)/m+(t<n?6:0);break;case t:o=(n-e)/m+2;break;case n:o=(e-t)/m+4;break}o/=6}return[o*360,r,a]},hslToRgb(e,t,n){e/=360;let l,s,o;if(t===0)l=s=o=n;else{const r=(c,g,h)=>(h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?c+(g-c)*6*h:h<.5?g:h<.6666666666666666?c+(g-c)*(.6666666666666666-h)*6:c),a=n<.5?n*(1+t):n+t-n*t,m=2*n-a;l=r(m,a,e+1/3),s=r(m,a,e),o=r(m,a,e-1/3)}return[Math.round(l*255),Math.round(s*255),Math.round(o*255)]},adjustColor(e,t=.5){const[n,l]=this.rgbToHsl(...e);return this.hslToRgb(n,l,t)}}},M={class:"heimgfont hevue-img-status-icon rotate-animation"},N=["src"],S=["src"],B={class:"heimgfont hevue-img-status-icon"},C={class:"he-bottom-wrap"},L={class:"hevue-custom-rotate-wrap"},E={class:"hevue-custom-range-label"},F=["onClick","innerHTML","title"],H={class:"he-imglist-wrap"},D=["onClick"],T=["src"],V={key:1,class:"he-control-num"},R={class:"hevue-img-help-wrap"},_={class:"hevue-img-help-item-label"},X={class:"hevue-img-help-item-desc"};function Y(e,t,n,l,s,o){return s.visible?(i.openBlock(),i.createElementBlock("div",{key:0,class:"hevue-imgpreview-wrap",id:"hevue-imgpreview-wrap",ref:"heImg",onMouseup:t[15]||(t[15]=r=>o.removeMove("pc")),onTouchend:t[16]||(t[16]=r=>o.removeMove("mobile"))},[i.createElementVNode("div",{class:i.normalizeClass(["hevue-img-mask",{heShow:s.showTranstion}]),onClick:t[0]||(t[0]=i.withModifiers((...r)=>o.clickMask&&o.clickMask(...r),["stop"]))},null,2),i.createElementVNode("div",{class:i.normalizeClass(["he-img-wrap",{heShow:s.showTranstion}])},[i.withDirectives(i.createElementVNode("div",M,"  ",512),[[i.vShow,s.imgState===1]]),o.vueVersion>2?(i.openBlock(),i.createBlock(i.TransitionGroup,{key:0,name:"fade"},{default:i.withCtx(()=>[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(s.needLoadImg,r=>i.withDirectives((i.openBlock(),i.createElementBlock("img",{src:r.url,onClick:t[1]||(t[1]=i.withModifiers(()=>{},["stop"])),key:r.index,ref_for:!0,ref:"heImg"+r.index,class:"he-img-view",style:i.normalizeStyle([s.imgIndex,s.fromIndex].includes(r.index)?o.getImgPostion:s.maxWH),onContextmenu:t[2]||(t[2]=(...a)=>o.imgContextMenu&&o.imgContextMenu(...a)),onMousedown:t[3]||(t[3]=(...a)=>o.addMove&&o.addMove(...a)),onTouchstart:t[4]||(t[4]=(...a)=>o.addMoveMobile&&o.addMoveMobile(...a))},null,44,N)),[[i.vShow,s.imgState===2&&s.imgIndex==r.index]])),128))]),_:1})):(i.openBlock(!0),i.createElementBlock(i.Fragment,{key:1},i.renderList(s.needLoadImg,r=>i.withDirectives((i.openBlock(),i.createElementBlock("img",{src:r.url,onClick:t[5]||(t[5]=i.withModifiers(()=>{},["stop"])),key:r.index,ref_for:!0,ref:"heImg"+r.index,class:"he-img-view",style:i.normalizeStyle([s.imgIndex,s.fromIndex].includes(r.index)?o.getImgPostion:s.maxWH),onContextmenu:t[6]||(t[6]=(...a)=>o.imgContextMenu&&o.imgContextMenu(...a)),onMousedown:t[7]||(t[7]=(...a)=>o.addMove&&o.addMove(...a)),onTouchstart:t[8]||(t[8]=(...a)=>o.addMoveMobile&&o.addMoveMobile(...a))},null,44,S)),[[i.vShow,s.imgState===2&&s.imgIndex==r.index]])),128)),i.withDirectives(i.createElementVNode("div",B,"  ",512),[[i.vShow,s.imgState===3]]),s.closeBtn?(i.openBlock(),i.createElementBlock("div",{key:2,class:"heimgfont he-close-icon",onClick:t[9]||(t[9]=i.withModifiers(r=>o.close({way:"closeBtn"}),["stop"]))},"  ")):i.createCommentVNode("",!0),s.arrowBtn&&o.multiple?(i.openBlock(),i.createElementBlock("div",{key:3,class:"arrow arrow-left heimgfont",onClick:t[10]||(t[10]=i.withModifiers(r=>o.prevNextHandle(!1,"arrow-btn"),["stop"]))},"  ")):i.createCommentVNode("",!0),s.arrowBtn&&o.multiple?(i.openBlock(),i.createElementBlock("div",{key:4,class:"arrow arrow-right heimgfont",onClick:t[11]||(t[11]=i.withModifiers(r=>o.prevNextHandle(!0,"arrow-btn"),["stop"]))},"  ")):i.createCommentVNode("",!0),i.createElementVNode("div",C,[i.createVNode(i.Transition,{name:"fade"},{default:i.withCtx(()=>[i.withDirectives(i.createElementVNode("div",L,[i.createElementVNode("span",E,i.toDisplayString(s.imgRotate)+"°",1),i.withDirectives(i.createElementVNode("input",{class:"hevue-custom-range","onUpdate:modelValue":t[12]||(t[12]=r=>s.imgRotate=r),type:"range",id:"vol",min:"0",max:"360",orient:"vertical"},null,512),[[i.vModelText,s.imgRotate,void 0,{number:!0}]])],512),[[i.vShow,s.showHevueImgRotate]])]),_:1}),s.controlBar.length?(i.openBlock(),i.createElementBlock("div",{key:0,onClick:t[13]||(t[13]=i.withModifiers(()=>{},["stop"])),class:"he-control-bar"},[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(o.controlbarShowItems,(r,a)=>i.withDirectives((i.openBlock(),i.createElementBlock("div",{class:"he-control-btn heimgfont",key:a,onClick:i.withModifiers(m=>r.handle(),["stop"]),innerHTML:r.icon,title:r.title},null,8,F)),[[i.vShow,r.show()]])),128))])):i.createCommentVNode("",!0),i.withDirectives(i.createElementVNode("div",H,[i.createElementVNode("div",{class:"he-imglist",style:i.normalizeStyle({left:o.getThumbLeft()+"px"})},[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(s.imgList,(r,a)=>(i.openBlock(),i.createElementBlock("div",{class:i.normalizeClass(["he-img-item",{active:a==s.imgIndex}]),key:a,onClick:m=>o.toogleImg(a,"thumb")},[i.createElementVNode("img",{src:r,class:"he-img-item-img",onContextmenu:t[14]||(t[14]=(...m)=>o.imgContextMenu&&o.imgContextMenu(...m))},null,40,T)],10,D))),128))],4)],512),[[i.vShow,s.thumbnail&&o.multiple]]),s.controlBar&&o.multiple?(i.openBlock(),i.createElementBlock("div",V,i.toDisplayString(s.imgIndex+1)+" / "+i.toDisplayString(s.imgList.length),1)):i.createCommentVNode("",!0)]),i.createVNode(i.Transition,{name:"fade"},{default:i.withCtx(()=>[i.withDirectives(i.createElementVNode("div",R,[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(s.shortcutList,r=>(i.openBlock(),i.createElementBlock("div",{class:"hevue-img-help-item",key:r.keyName},[i.createElementVNode("div",_,i.toDisplayString(r.keyName)+"：",1),i.createElementVNode("div",X,i.toDisplayString(r.desc),1)]))),128))],512),[[i.vShow,s.showHevueImgHelp]])]),_:1})],2)],544)):i.createCommentVNode("",!0)}const O=v(b,[["render",Y],["__scopeId","data-v-7f6813f1"]]);let f={};function k(e){typeof e=="string"?e={imgList:[e]}:Array.isArray(e)&&(e={imgList:e}),Object.keys(f).forEach(o=>{e[o]===void 0&&(e[o]=f[o])});const t=document.getElementById("hevue-img-preview-container");t&&t.remove();const n=document.createElement("div");n.id="hevue-img-preview-container",n.style.zIndex=e.zIndex||"9999",document.body.appendChild(n);const s=i.createApp(O).mount(n);return Object.keys(e).map(o=>{s[o]=e[o]}),s.show(),s}const P={install(e,t={}){f=t,e.config.globalProperties.$hevueImgPreview=k}};d.default=P,d.previewImages=k,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
